# =============================================================================
# Tend Mobile - Development Dockerfile
# =============================================================================
# Development image with hot reload support for Ionic/Angular
#
# =============================================================================

FROM node:20-alpine

# Install development tools
RUN apk add --no-cache python3 make g++ git chromium

# Set Chrome path for testing
ENV CHROME_BIN=/usr/bin/chromium-browser

WORKDIR /app

# Copy package files
COPY package*.json ./
COPY nx.json ./
COPY tsconfig*.json ./
COPY prisma ./prisma/

# Install all dependencies
RUN npm ci

# Generate Prisma client (for shared types)
RUN npx prisma generate

# Copy source files
COPY apps/mobile ./apps/mobile
COPY libs ./libs

# Environment
ENV NODE_ENV=development

# Expose Ionic dev server port
EXPOSE 4200

# Start with hot reload
CMD ["npx", "nx", "serve", "mobile", "--host=0.0.0.0", "--poll=2000", "--disable-host-check"]
